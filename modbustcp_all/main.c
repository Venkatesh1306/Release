/*
 * File:   main.c
 * Author: Vivek
 *
 * Created on 17 April, 2024, 11:20 AM
 */



#include "libModbusTcp/modbusTcp.h"
#include <stdio.h>


uint16_t dataMemory[125] = {
    0x0304, 0x0554, 0x0AAB, 0x0C39, 0x0F7E, 0x0DE2, 0x0B6F, 0x0E3A, 0x089D, 0x0F48,
    0x0910, 0x06A1, 0x0F1D, 0x002B, 0x0BBE, 0x0DCE, 0x081F, 0x0C7C, 0x06F2, 0x043F,
    0x03E8, 0x0D4D, 0x008E, 0x0A88, 0x0C97, 0x0DA5, 0x0EF7, 0x06B2, 0x0E53, 0x0B81,
    0x03D2, 0x00C5, 0x03E9, 0x02F6, 0x0B32, 0x0AFC, 0x0721, 0x0C80, 0x0415, 0x0E36,
    0x06D8, 0x0E99, 0x0523, 0x0DA9, 0x032C, 0x0FF2, 0x07A3, 0x0BCD, 0x02A0, 0x05FE,
    0x057D, 0x0839, 0x0DD7, 0x07C4, 0x09E1, 0x01AA, 0x09C6, 0x0A1F, 0x0798, 0x08A2,
    0x0BFC, 0x0C3E, 0x08B4, 0x0EAB, 0x0586, 0x0B17, 0x0F9E, 0x0F6D, 0x0A55, 0x0DC4,
    0x0FB3, 0x085D, 0x0AE9, 0x0C22, 0x0D61, 0x062A, 0x067B, 0x0C45, 0x0B60, 0x0493,
    0x0FAA, 0x0D2B, 0x0EA8, 0x03B1, 0x07E0, 0x08E7, 0x0E65, 0x0C9C, 0x014F, 0x00D6,
    0x040B, 0x01C8, 0x07B6, 0x0F3D, 0x037E, 0x0349, 0x0464, 0x0282, 0x09A7, 0x050F
};

uint8_t modbusTcpRxBuf[50] = {0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x01, 0x00, 0x11, 0x00, 0x09};
uint8_t modbusTcpTxBuf[100];
uint16_t modBusframeLength;

int
main() {

    modbusTcpFrame(&modbusTcpRxBuf[0], &dataMemory[0], &modbusTcpTxBuf[0], &modBusframeLength);

    printf("Actual Response:\n");
    int responseLength = (modbusTcpTxBuf[7] == 0x06 || modbusTcpTxBuf[7] == 0x10 || modbusTcpTxBuf[7] == 0x05 || modbusTcpTxBuf[7] == 0x0f) ? 0x0C : ((modbusTcpTxBuf[7] < 0x80) ? 0x09 + modbusTcpTxBuf[8] : 0x09);
    for (int i = 0; i < responseLength; i++)
        printf("%02X ", modbusTcpTxBuf[i]);
    printf("\n");

    modbusTcpRxBuf[99] = 0;


}

